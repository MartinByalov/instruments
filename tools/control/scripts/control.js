let timerId = null;
let mode = 'initial';
const angryDuration = 120;
// !!! –ü—Ä–æ–º–µ–Ω–ª–∏–≤–∏—Ç–µ, –∫–æ–∏—Ç–æ –∑–∞–≤–∏—Å—è—Ç –æ—Ç DOM, —Å–∞ –¥–µ–∫–ª–∞—Ä–∏—Ä–∞–Ω–∏ –±–µ–∑ —Å—Ç–æ–π–Ω–æ—Å—Ç
let statusDisplay = null;
let body = null;
let alarmSound = null; // –ê–∫–æ –∏–∑–ø–æ–ª–∑–≤–∞—Ç–µ –∞—É–¥–∏–æ –µ–ª–µ–º–µ–Ω—Ç –≤ HTML

const happyQuotes = [
    "‚Äû–ú–µ—á—Ç–∏—Ç–µ –Ω–∞—Ä–æ—á–Ω–æ —Å–∞ —Å –ø–æ-–≥–æ–ª—è–º —Ä–∞–∑–º–µ—Ä, –∑–∞ –¥–∞ –º–æ–∂–µ–º –¥–∞ –ø–æ—Ä–∞—Å–Ω–µ–º –≤ —Ç—è—Ö.‚Äú ‚Äì –î–∂–æ—É–∑–∏ –ë–∏—Å–µ—Ç",
    "‚Äû–í –∂–∏–≤–æ—Ç–∞ –Ω—è–º–∞ —Å–º–∏—Å—ä–ª, –∏–º–∞ —Å–∞–º–æ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏.‚Äú ‚Äì –ú–∞—Ä–∫ –¢–≤–µ–Ω",
    "–¶–µ–ª–∏—è—Ç —Å–≤—è—Ç –ø—Ä–∞–≤–∏ –ø—ä—Ç –Ω–∞ —Ç–æ–∑–∏, –∫–æ–π—Ç–æ –∑–Ω–∞–µ –∫—ä–¥–µ –æ—Ç–∏–≤–∞.",
    "‚Äû–ù–∞–π-–≤–∞–∂–Ω–æ—Ç–æ –µ –¥–∞ –≤—è—Ä–≤–∞—à –≤ —Å–µ–±–µ —Å–∏‚Ä¶ –ú–Ω–µ–Ω–∏–µ—Ç–æ –Ω–∞ –¥—Ä—É–≥–∏—Ç–µ —Å–µ –º–µ–Ω–∏ –Ω–µ–ø—Ä–µ–∫—ä—Å–Ω–∞—Ç–æ.‚Äú ‚Äì –£–∏–Ω—Å—Ç—ä–Ω –ß—ä—Ä—á–∏–ª",
    "–û—Ç –º–∏–Ω–∞–ª–æ—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –≤–∑–µ–º–µ—Ç–µ –æ–≥—ä–Ω—è, –∞ –Ω–µ –ø–µ–ø–µ–ª—Ç–∞.",
    "–ù–µ –ø–æ–∑–≤–æ–ª—è–≤–∞–π—Ç–µ –¥—É—à–∞—Ç–∞ –≤–∏ –¥–∞ –∏–∑—Å—Ç–∏–Ω–µ‚Ä¶ –ó–∞–≤–∏–≤–∞–π—Ç–µ —è —Å –º–µ—á—Ç–∏.",
    "‚Äû–ß—É–¥–µ—Å–∞—Ç–∞ –∑–∞–ø–æ—á–≤–∞—Ç –¥–∞ —Å–µ —Å–ª—É—á–≤–∞—Ç —Ç–æ–≥–∞–≤–∞, –∫–æ–≥–∞—Ç–æ —Å–ø—Ä–µ—à –¥–∞ –æ—Ç–¥–∞–≤–∞—à –µ–Ω–µ—Ä–≥–∏—è—Ç–∞ —Å–∏ –Ω–∞ —Å—Ç—Ä–∞—Ö–æ–≤–µ—Ç–µ —Å–∏ –∏ –∑–∞–ø–æ—á–Ω–µ—à –¥–∞ —è –≤–ª–∞–≥–∞—à –≤ –º–µ—á—Ç–∏—Ç–µ —Å–∏.‚Äú ‚Äì –§–∏–ª–∏–ø –£–∏–ª–∫–∏–Ω—Å—ä–Ω",
    "‚Äû–ó–∞ –¥–∞ –æ–∑–∞—Ä–∏—à —Å–≤–µ—Ç–∞ –Ω–∞ –¥—Ä—É–≥–∏—Ç–µ –µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞ –Ω–æ—Å–∏—à –°–ª—ä–Ω—Ü–µ—Ç–æ –≤ —Å–µ–±–µ —Å–∏.‚Äú ‚Äì –†–æ–º–µ–Ω –†–æ–ª–∞–Ω",
    "‚Äû–¢–æ–∑–∏, –∫–æ–π—Ç–æ –µ —É–≤–µ—Ä–µ–Ω –≤ —Å–æ–±—Å—Ç–≤–µ–Ω–∞—Ç–∞ —Å–∏ —Å–≤–µ—Ç–ª–∏–Ω–∞, –Ω–µ —Å–µ –ø—Ä–∏—Ç–µ—Å–Ω—è–≤–∞ –æ—Ç –±–ª—è—Å—ä–∫–∞ –Ω–∞ –¥—Ä—É–≥–∏—Ç–µ.‚Äú ‚Äì –í–∏–∫—Ç–æ—Ä –Æ–≥–æ",
    "–ù–∞–π-—Ö—É–±–∞–≤–∏—Ç–µ –Ω–µ—â–∞ –≤ –∂–∏–≤–æ—Ç–∞ —Å–∞ —Ö–æ—Ä–∞—Ç–∞, –∫–æ–∏—Ç–æ –æ–±–∏—á–∞—à, –º–µ—Å—Ç–∞—Ç–∞, –∫–æ–∏—Ç–æ —Å–∏ –≤–∏–¥—è–ª –∏ —Å–ø–æ–º–µ–Ω–∏—Ç–µ, –∫–æ–∏—Ç–æ —Å–∏ —Å—ä–∑–¥–∞–ª!",
    "‚Äû–ß–æ–≤–µ–∫ –µ —É—Å—Ç—Ä–æ–µ–Ω —Ç–∞–∫–∞, —á–µ –∫–æ–≥–∞—Ç–æ –Ω–µ—â–æ –∑–∞–ø–∞–ª–∏ –¥—É—à–∞—Ç–∞ –º—É, –≤—Å–∏—á–∫–æ –µ –≤—ä–∑–º–æ–∂–Ω–æ.‚Äú ‚Äì –õ–∞—Ñ–æ–Ω—Ç–µ–Ω",
    "–û–±—Ä—ä—â–∞–π –ª–∏—Ü–µ—Ç–æ —Å–∏ –≤–∏–Ω–∞–≥–∏ –ø–æ –ø–æ—Å–æ–∫–∞ –Ω–∞ —Å–ª—ä–Ω—Ü–µ—Ç–æ –∏ —Å–µ–Ω–∫–∏—Ç–µ —â–µ –æ—Å—Ç–∞–Ω–∞—Ç –∑–∞–¥ –≥—ä—Ä–±–∞ —Ç–∏.",
    "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—Ç–∞ –µ –Ω–∞–π-–∫—Ä–∞—Å–∏–≤–∏—è—Ç —Ü–≤—è—Ç –Ω–∞ –¥—É—à–∞—Ç–∞!",
    "–ù–∏–∫–æ–π –Ω–µ –ø—Ä–∞–≤–∏ –∫–ª—é—á–∞–ª–∫–∞ –±–µ–∑ –∫–ª—é—á. –¢–∞–∫–∞ –∏ –∂–∏–≤–æ—Ç—ä—Ç –Ω–µ –¥–∞–≤–∞ –ø—Ä–æ–±–ª–µ–º –±–µ–∑ —Ä–µ—à–µ–Ω–∏—è.",
    "‚Äû–ú–∞–ª–∫–∏—Ç–µ —Ä–µ—à–µ–Ω–∏—è —Ç—Ä—è–±–≤–∞ –¥–∞ —Å–µ –≤–∑–µ–º–∞—Ç —Å –≥–ª–∞–≤–∞—Ç–∞, –∞ –≥–æ–ª–µ–º–∏—Ç–µ ‚Äì —Å—ä—Å —Å—ä—Ä—Ü–µ—Ç–æ.‚Äú",
    "–í—Å–µ–∫–∏ –Ω–æ–≤ –¥–µ–Ω –µ –∫–∞—Ç–æ –±—è–ª –ª–∏—Å—Ç. –û—Ç –Ω–∞—Å –∑–∞–≤–∏—Å–∏ –¥–∞–ª–∏ —â–µ –≥–æ –∏–∑–ø—ä–ª–Ω–∏–º —Å –∫—Ä–∞—Å–∏–≤–∏ –∫–∞—Ä—Ç–∏–Ω–∏.",
    "–í–∏–Ω–∞–≥–∏ —Å–µ —Å–º–µ–π, –∫–æ–≥–∞—Ç–æ –º–æ–∂–µ—à. –°–º–µ—Ö—ä—Ç –µ –Ω–∞–π-–µ–≤—Ç–∏–Ω–æ—Ç–æ –ª–µ–∫–∞—Ä—Å—Ç–≤–æ.",
    "–í–∏–Ω–∞–≥–∏ –∑–∞—Å–ø–∏–≤–∞–π —Å –º–µ—á—Ç–∞ –∏ —Å–µ —Å—ä–±—É–∂–¥–∞–π —Å —Ü–µ–ª!",
    "‚Äû–î–∞ –≤–ª–∞–¥–µ–µ—à —Å–µ–±–µ —Å–∏ –µ –ø–æ-–¥–æ–±—Ä–µ, –æ—Ç–∫–æ–ª–∫–æ—Ç–æ –¥–∞ –≤–ª–∞–¥–µ–µ—à –≤—Å–∏—á–∫–∏ –æ—Å—Ç–∞–Ω–∞–ª–∏.‚Äú ‚Äì –ë—É–¥–∞",
    "–ò—Å—Ç–∏–Ω—Å–∫–∏—è—Ç –≤–∏ –∂–∏–≤–æ—Ç –∑–∞–ø–æ—á–≤–∞ —Ç–æ–≥–∞–≤–∞, –∫–æ–≥–∞—Ç–æ –≤–∞—à–µ—Ç–æ —â–∞—Å—Ç–∏–µ –µ –ø–æ-–≤–∞–∂–Ω–æ –æ—Ç —Ö–æ—Ä—Å–∫–æ—Ç–æ –º–Ω–µ–Ω–∏–µ."
];

function getRandomStudents() {
    const studentCount = 25;
    const numbers = [];
    while(numbers.length < 3){
        const r = Math.floor(Math.random() * studentCount) + 1;
        if(numbers.indexOf(r) === -1) numbers.push(r);
    }
    return numbers.join(', ');
}

function getRandomQuote() {
    const index = Math.floor(Math.random() * happyQuotes.length);
    return happyQuotes[index];
}

function setMode(newMode) {
    // üõ°Ô∏è –ó–∞—â–∏—Ç–∞: –ü—Ä–æ–≤–µ—Ä—è–≤–∞ –¥–∞–ª–∏ DOM –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ —Å–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–∏
    if (!statusDisplay || !body) { 
        console.error('Error: statusDisplay or body element not initialized yet. Check your HTML for id="status-display".');
        return; 
    }
    
    if (timerId !== null) {
        clearInterval(timerId);
        timerId = null;
    }
    mode = newMode;
    statusDisplay.className = `status ${mode}`;
    body.classList.remove('bg-happy', 'bg-angry');

    if (mode === 'happy') {
        body.classList.add('bg-happy');
        const quote = getRandomQuote();
        statusDisplay.innerHTML = `</p><p>‚ú®${quote}‚ú®</p>`;
    } else if (mode === 'angry') {
        body.classList.add('bg-angry');
        startAngryTimer();
    }
}

function startAngryTimer() {
    let timeLeft = angryDuration;
    const studentNumbers = getRandomStudents();

    function updateDisplay() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        statusDisplay.innerHTML =
            `<p>üö® –ò–∑–ø–∏—Ç–≤–∞–Ω–µ –Ω–∞ —Ç—Ä–∏–º–∞ —É—á–µ–Ω–∏—Ü–∏ —Å –Ω–æ–º–µ—Ä–∞: ${studentNumbers}</p>
             <p>—Å–ª–µ–¥ **${timeString}**</p>`;

        if (timeLeft <= 0) {
            clearInterval(timerId);
            timerId = null;
            
            if (alarmSound) { 
                alarmSound.play();
            }
            
            statusDisplay.innerHTML =
                `<p>üõë –í–†–ï–ú–ï–¢–û –ò–ó–¢–ï–ß–ï! –ò–∑–ø–∏—Ç–≤–∞–Ω–µ –Ω–∞ –Ω–æ–º–µ—Ä–∞: ${studentNumbers}</p>
                 <p>–°–º–µ–Ω–µ—Ç–µ –Ω–∞ —É—Å–º–∏—Ö–Ω–∞—Ç–æ –µ–º–æ–¥–∂–∏, –∑–∞ –¥–∞ –Ω—É–ª–∏—Ä–∞—Ç–µ.</p>`;
        } else {
            timeLeft--;
        }
    }

    timerId = setInterval(updateDisplay, 1000);
    updateDisplay();
}

document.addEventListener('DOMContentLoaded', () => {
    // üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –ò–∑–ø—ä–ª–Ω—è–≤–∞ —Å–µ –µ–¥–≤–∞ —Å–ª–µ–¥ –∫–∞—Ç–æ –≤—Å–∏—á–∫–∏ HTML –µ–ª–µ–º–µ–Ω—Ç–∏ —Å–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏
    statusDisplay = document.getElementById('status-display');
    body = document.body;
    alarmSound = document.getElementById('alarm-sound'); 
    
    // –ú–æ–∂–µ –¥–∞ –∏–∑–≤–∏–∫–∞—Ç–µ setMode('initial') —Ç—É–∫, –∞–∫–æ –∏—Å–∫–∞—Ç–µ –Ω–∞—á–∞–ª–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ.
    
    // –ê–∫–æ –∏—Å–∫–∞—Ç–µ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ –≤ Happy mode –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ, –º–∞—Ö–Ω–µ—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä–∞ –æ—Ç –¥–æ–ª–Ω–∏—è —Ä–µ–¥:
    // setMode('happy'); 
});